---
layout: single
title:  "JDBC 2 - JDBC í”„ë¡œê·¸ë˜ë°"
categories: JDBC
tags: [database, JDBC]
toc: true
toc_sticky: true
author_profile: false
sidebar:
    nav: "docs"
search: false
order : 2
---

<br>

###### ğŸ˜ƒ JDBC

- Java DataBase Connectivity
- ìë°” í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¡œ ë§Œë“¤ì–´ì§„ SQLë¬¸ì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ í˜¸ì¶œ ì¸í„°í˜ì´ìŠ¤

![image-20220331201549508](../../../images/db/2022-03-31-jdbc/image-20220331201549508.png)

<br><br>

###### ğŸ˜ƒ JDBC ì‘ì—… ìˆœì„œ

![image-20220331221855096](../../../images/db/2022-03-31-jdbc/image-20220331221855096.png)

------------

**1. JDBC Driver Loading** 

- DB ì ‘ì†ì„ ìœ„í•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ JVM ì•ˆìœ¼ë¡œ íŠ¹ì • ë“œë¼ì´ë²„ í´ë˜ìŠ¤ë¥¼ ì ì¬

- <span style="color:blue">Class.forName( Driver ClassName )</span>

- [MySQL] Driver Class : "com.mysql.cj.jdbc.Driver"

  ``` java
  private static final String DRIVER = "com.mysql.cj.jdbc.Driver";
  try {
  	Class.forName(DRIVER);
  	System.out.println("ë“œë¼ì´ë²„ ë¡œë”© ì„±ê³µ!!");
  } catch (ClassNotFoundException e) {
  	e.printStackTrace();
  	System.out.println("ë“œë¼ì´ë²„ ë¡œë”© ì‹¤íŒ¨!!");
  }
  ```

  <br>

------------------------

**2. DBMS ì—°ê²° (Connection ìƒì„±)**

- DriverManager í´ë˜ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ URLí˜•íƒœë¡œ ì£¼ì–´ì§„ ë°ì´í„° ë² ì´ìŠ¤ì— ëŒ€í•œ ì ‘ì† ìš”ì²­

- <span style="color:blue">Connection conn = DriverManager.getConnection(URL, dbid, dbpassword);</span>

- [MySQL] JDBC URL : jdbc:mysql://[HOST]:[PORT]/[DBNAME]?[param1=value1]&[param2=value2]&[..] 

  ``` java
  private static final String URL = "jdbc:mysql://localhost:3306/happyhouse?serverTimezone=UTC&useUniCode=yes&characterEncoding=UTF-8";
  private static final String DB_ID = "ssafy";
  private static final String DB_PASS = "ssafy";
  
  public static Connection getConnection() throws SQLException{
  	return DriverManager.getConnection(URL, DB_ID, DB_PASS);
  }
  ```

<br>

-------------

**3. SQL ì‹¤í–‰ ì¤€ë¹„ (Statement, PreparedStatement ìƒì„±)**

- String sql = â€œinsert, update, delete, select, â€¦â€;

- **Statement ìƒì„±** :  <span style="color:blue">Statement stmt = conn.createStatement();</span>

- **PreparedStatement ìƒì„±** : <span style="color:blue">PreparedStatement pstmt = conn.prepareStatement(sql);</span>

  ```java
  Connection conn = null;
  PreparedStatement pstmt = null;
  ResultSet rs = null;
  
  try {
  	conn = DBConnection.getConnection();
  	String sql = "select i.dongName, i.aptName, h.area,h.dealamount,h.dealYear,h.dealMonth,i.lat,i.lng ";
  	sql += "from housedeal h, houseinfo i where h.aptCode=i.aptCode and dongName like ?";
  	
  	pstmt = conn.prepareStatement(sql);
  ```



<br>

--------------

**4. SQL ì‹¤í–‰ (executeUpdate, executeQuery)**

- **Statement**
  
  - Insert, Update, Delete :  <span style="color:blue">int cnt = stmt.executeUpdate(sql);</span>
  
    <span style="color:red">*** executeUpdateëŠ” ìˆ˜í–‰ëœ ë ˆì½”ë“œì˜ ìˆ˜ê°€ ë°˜í™˜ëœë‹¤</span>
  
  - Select :  <span style="color:blue">ResultSet rs = stmt.executeQuery(sql);</span>
  
    <span style="color:red">*** executeQueryëŠ” ê°ì²´ê°’ì´ ë°˜í™˜ëœë‹¤</span>
  
- **PreparedStatement**
  
  - sql ë¬¸ì˜ ì¹˜í™˜ë³€ìˆ˜ ê°’ ì„¤ì • : <span style="color:blue">pstmt.setXXX(index, val);</span>
  - Insert, Update, Delete :  <span style="color:blue">int cnt = pstmt.executeUpdate();</span>
  - Select :  <span style="color:blue">ResultSet rs = pstmt.executeQuery();</span>
  
- **ResultSet**
  
  - ResultSetì„ ì–»ì–´ì˜¨ í›„ rs.next()ë¥¼ ì‹¤í–‰í•´ì•¼ í•œë‹¤
    - selectì˜ ê²°ê³¼ê°€ ë°˜ë“œì‹œ í•˜ë‚˜ê°€ ë‚˜ì˜¤ëŠ” ê²½ìš° : <span style="color:blue">rs.next();</span>
    - selectì˜ ê²°ê³¼ê°€ í•˜ë‚˜ ë˜ëŠ” ëª» ì–»ì–´ ì˜¤ëŠ” ê²½ìš° : <span style="color:blue">if(rs.next) { }</span>
    - selectì˜ ê²°ê³¼ê°€ ì—¬ëŸ¬ ê°œê°€ ë‚˜ì˜¬ ìˆ˜ ìˆëŠ” ê²½ìš° : <span style="color:blue">while(rs.next()) { }</span>
  - ê°’ ì–»ê¸°
    - <span style="color:blue">String str = rs.getString(index or name);</span>
    - <span style="color:blue">int cnt = rs.getInt(index or name);</span>
  
  <br>
  
  ``` java
  try {
  	conn = DBConnection.getConnection();
  	String sql = "select i.dongName, i.aptName, h.area,h.dealamount,h.dealYear,h.dealMonth,i.lat,i.lng ";
  	sql += "from housedeal h, houseinfo i where h.aptCode=i.aptCode and dongName like ?";
  	pstmt = conn.prepareStatement(sql);
  	
  	String names = dongName+'%';
  	pstmt.setString(1,names);
  	rs = pstmt.executeQuery();
  	while (rs.next()) {
  		aptDto = new AptDto();
  		aptDto.setDongName(rs.getString("i.dongName"));
  		aptDto.setAptName(rs.getString("i.aptName"));
      }
  ```
  
  

<br>

----------------

**5. DBMS ì—°ê²° ì¢…ë£Œ**

- ëª¨ë“  ì‘ì—… ëë‚œ ê²½ìš°ì— ResultSet, Statement, Connection ê°ì²´ì˜ close() ë©”ì†Œë“œë¥¼ ì´ìš©í•˜ì—¬ ì‘ì—…ì„ ì¢…ë£Œí•œë‹¤. (ì—°ê²° ì—­ìˆœìœ¼ë¡œ ì¢…ë£Œ)

- Connectionì€ ìƒë‹¹í•œ Overheadë¥¼ ê°€ì ¸ì˜¨ë‹¤. ë”°ë¼ì„œ ìµœì í™”ëœ ìƒíƒœë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ì„œëŠ” ë°˜ë“œì‹œ Connectionì„ ë‹«ì•„ ì£¼ì–´ì•¼ í•œ ë‹¤.
  - <span style="color:blue">rs.close();</span>
  - <span style="color:blue">pstmt.close();</span>
  - <span style="color:blue">conn.close();</span>
  
  <br>
  
  ``` java
  public static void close(Connection conn, PreparedStatement pstmt, ResultSet rs) {
  	try {
  		if(rs != null)
  			rs.close();
  		if(pstmt != null)
  			pstmt.close();
  		if(conn != null)
  			conn.close();
  	} catch (SQLException e) {
  		e.printStackTrace();
  	}
  }
  ```
  
  ``` java
  try {
  	conn = DBConnection.getConnection();
  	String sql = "select i.dongName, i.aptName, h.area,h.dealamount,h.dealYear,h.dealMonth,i.lat,i.lng ";
  	sql += "from housedeal h, houseinfo i where h.aptCode=i.aptCode and dongName like ?";
  	pstmt = conn.prepareStatement(sql);
  	
  	String names = dongName+'%';
  	pstmt.setString(1,names);
  	rs = pstmt.executeQuery();
      while (rs.next()) {
  		aptDto = new AptDto();
  		aptDto.setDongName(rs.getString("i.dongName"));
  		aptDto.setAptName(rs.getString("i.aptName"));
  	}
  } catch (SQLException e) {
  	e.printStackTrace();
  } finally {
  	DBClose.close(conn, pstmt, rs);
  }
  ```
  
  <br><br>

